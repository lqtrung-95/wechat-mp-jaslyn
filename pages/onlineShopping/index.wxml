<view class="page">
  <view class="form-card">
    <view class="form-card__header">
      <view class="form-card__header-content">
        <view>
        <view class="form-card__title">{{pageCopy.heroTitle}}</view>
          <view class="form-card__title">{{pageCopy.heroTitle.replace(pageCopy.heroTitle.split(' ')[0], '').trim()}}</view>
          <view class="form-card__subtitle">{{pageCopy.heroSubtitle}}</view>
        </view>
      </view>
      <view class="language-switcher" bindtap="toggleLanguage">
        <text class="language-switcher__icon">üåê</text>
        <text class="language-switcher__text">{{language === 'zh' ? 'EN' : '‰∏≠'}}</text>
      </view>
    </view>

    <view class="info-banner info-banner--supported">
      <view class="info-banner__title">üåç {{globalCopy.supportedAreasTitle}}</view>
      <view class="info-banner__body">
        <text class="info-banner__text">{{pageCopy.supportedAreasContent}}</text>
      </view>
    </view>

    <!-- Address Section -->
    <view class="section">
      <view class="section__title">
        <text class="section__icon">üìç</text>
        <text>{{globalCopy.deliverySectionTitle}}</text>
      </view>

      <!-- Address Preview Card -->
      <view wx:if="{{formData.country || formData.customCountry}}" class="address-preview-card">
        <view class="address-preview-content">
          <text wx:if="{{selectedCountry}}" class="address-preview-flag">{{selectedCountry.flag}}</text>
          <view class="address-preview-text">
            <text class="address-preview-label">{{globalCopy.deliverySectionTitle}}</text>
            <text class="address-preview-value">{{isCustomCountry ? formData.customCountry : formData.country}}{{formData.city ? ' ¬∑ ' + formData.city : ''}}</text>
          </view>
        </view>
      </view>

      <view class="section__grid">
        <view class="field field--half">
          <text class="field__label">{{globalCopy.countryLabel}}</text>
          <picker mode="selector" range="{{countryOptions}}" value="{{selectedCountryIndex < 0 ? 0 : selectedCountryIndex}}" bindchange="handleCountryChange">
            <view class="picker__trigger">
              <text class="picker__text {{isCustomCountry || selectedCountryIndex === -1 ? 'picker__text--placeholder' : ''}}">{{isCustomCountry ? globalCopy.customOptionLabel : selectedCountryIndex > -1 ? countryOptions[selectedCountryIndex] : globalCopy.selectCountry}}</text>
              <text class="picker__chevron">‚åµ</text>
            </view>
          </picker>
        </view>

        <view class="field field--half" wx:if="{{isCustomCountry}}">
          <text class="field__label">{{globalCopy.customCountryLabel}}</text>
          <input class="field__control" placeholder="{{globalCopy.customCountryPlaceholder}}" value="{{formData.customCountry}}" data-field="customCountry" bindinput="handleInput" />
        </view>

        <view class="field field--half">
          <text class="field__label">{{globalCopy.cityLabel}}</text>
          <picker wx:if="{{!isCustomCountry}}" mode="selector" range="{{cityOptions}}" value="{{selectedCityIndex < 0 ? 0 : selectedCityIndex}}" bindchange="handleCityChange" disabled="{{!cityOptions.length}}">
            <view class="picker__trigger {{!cityOptions.length ? 'picker__trigger--disabled' : ''}}">
              <text class="picker__text {{selectedCityIndex === -1 ? 'picker__text--placeholder' : ''}}">{{selectedCityIndex > -1 ? formData.city : globalCopy.selectCity}}</text>
              <text class="picker__chevron">‚åµ</text>
            </view>
          </picker>
          <input wx:if="{{isCustomCountry}}" class="field__control" placeholder="{{globalCopy.customCityPlaceholder}}" value="{{formData.customCity}}" data-field="customCity" bindinput="handleInput" />
        </view>

        <view class="field field--full">
          <text class="field__label">{{globalCopy.detailAddressLabel}}</text>
          <textarea class="field__textarea" placeholder="{{globalCopy.detailAddressPlaceholder}}" value="{{formData.detailAddress}}" data-field="detailAddress" bindinput="handleInput"></textarea>
        </view>
      </view>

      <text class="note note--secondary">{{globalCopy.cityNote}}</text>

      <view wx:if="{{!formData.country && !formData.customCountry}}" class="message-banner warning">
        <text>‚ö†Ô∏è {{globalCopy.formAddressHint}}</text>
      </view>

      <view wx:if="{{validationResult}}" class="message-banner {{validationResult.state}}">{{validationResult.message}}</view>

      <view class="section__actions">
        <button class="secondary-btn" bindtap="handleValidateAddress" loading="{{validating}}" disabled="{{validating || (!formData.country && !formData.customCountry) || (!formData.city && !formData.customCity) || !formData.detailAddress}}">{{globalCopy.validationButton}}</button>
      </view>
    </view>

    <!-- Requirements Section -->
    <view class="section">
      <view class="section__title">
        <text class="section__icon">üõçÔ∏è</text>
        <text>{{globalCopy.requirementsSectionTitle}}</text>
      </view>
      
      <view class="field field--full">
        <text class="field__label">{{pageCopy.requirementLabel}}</text>
        <picker mode="selector" range="{{productTypeOptions}}" value="{{selectedProductTypeIndex}}" bindchange="handleProductTypeChange">
          <view class="picker__trigger">
            <text class="picker__text {{selectedProductTypeIndex === -1 ? 'picker__text--placeholder' : ''}}">{{selectedProductTypeIndex > -1 ? formData.foodType : pageCopy.requirementPlaceholder}}</text>
            <text class="picker__chevron">‚åµ</text>
          </view>
        </picker>
      </view>

      <view class="field field--full">
        <text class="field__label">{{globalCopy.notesLabel}}</text>
        <textarea class="field__textarea" placeholder="{{pageCopy.notesPlaceholderSpecific}}" value="{{formData.notes}}" data-field="notes" bindinput="handleInput"></textarea>
      </view>
    </view>

    <!-- Contact Section -->
    <view class="section">
      <view class="section__title">
        <text class="section__icon">üìû</text>
        <text>{{globalCopy.contactSectionTitle}}</text>
      </view>
      <view class="section__grid">
        <view class="field field--half">
          <text class="field__label">{{globalCopy.contactNameLabel}}</text>
          <input class="field__control" placeholder="{{globalCopy.contactNamePlaceholder}}" value="{{formData.customerName}}" data-field="customerName" bindinput="handleInput" />
        </view>
        <view class="field field--half">
          <text class="field__label">{{globalCopy.contactPhoneLabel}}</text>
          <input class="field__control" placeholder="{{globalCopy.contactPhonePlaceholder}}" value="{{formData.customerPhone}}" data-field="customerPhone" bindinput="handleInput" />
        </view>
        <view class="field field--full">
          <text class="field__label">{{globalCopy.contactWechatLabel}}</text>
          <input class="field__control" placeholder="{{globalCopy.contactWechatPlaceholder}}" value="{{formData.customerWechat}}" data-field="customerWechat" bindinput="handleInput" />
        </view>
      </view>
    </view>

    <view wx:if="{{submitResult}}" class="message-banner {{submitResult.state}}">{{submitResult.message}}</view>
    
    <view wx:if="{{!validationResult || validationResult.state !== 'success'}}" class="message-banner error">
      <text>{{globalCopy.submitReminder}}</text>
    </view>

    <button class="primary-btn primary-btn--block" bindtap="handleSubmit" loading="{{submitting}}" disabled="{{submitting || !validationResult || validationResult.state !== 'success'}}">{{globalCopy.submitButton}}</button>
  </view>
</view>
